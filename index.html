<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

const certImage = new Image();
certImage.src = "certificate.png";

let imageLoaded = false;

certImage.onload = () => {
  imageLoaded = true;
  canvas.width = certImage.naturalWidth;
  canvas.height = certImage.naturalHeight;
  ctx.drawImage(certImage, 0, 0);
};

certImage.onerror = () => {
  alert("ERROR: certificate.png failed to load. Check filename and refresh cache.");
};

function generateCert() {
  if (!imageLoaded) {
    alert("Certificate image still loading. Try again in a second.");
    return;
  }

  const name = document.getElementById("nameInput").value.trim();
  if (!name) {
    alert("Enter your name first!");
    return;
  }

  // Redraw base certificate
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.drawImage(certImage, 0, 0);

  // ===== NAME =====
  ctx.font = "120px Impact";
  ctx.fillStyle = "#000000";
  ctx.textAlign = "center";

  // Drop shadow
  ctx.shadowColor = "rgba(0,0,0,0.45)";
  ctx.shadowBlur = 6;
  ctx.shadowOffsetX = 3;
  ctx.shadowOffsetY = 3;

  const nameX = canvas.width / 2;
  const nameY = canvas.height * 0.67;
  ctx.fillText(name, nameX, nameY);

  // ===== DATE =====
  const today = new Date();
  const dateString = today.toLocaleDateString("en-GB", {
    day: "numeric",
    month: "short",
    year: "numeric"
  });

  ctx.font = "42px Arial";
  ctx.fillStyle = "#ffffff";
  ctx.shadowColor = "rgba(0,0,0,0.4)";
  ctx.shadowBlur = 4;

  const dateX = canvas.width / 2;
  const dateY = canvas.height * 0.77;

  ctx.fillText(dateString, dateX, dateY);

  // Reset shadow
  ctx.shadowColor = "transparent";
}

function downloadCert() {
  const link = document.createElement("a");
  link.download = "WRW_Rattler_Certificate.png";
  link.href = canvas.toDataURL("image/png");
  link.click();
}
</script>