<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

const certImage = new Image();
certImage.src = "certificate.png";

let imageLoaded = false;

certImage.onload = () => {
  imageLoaded = true;
  canvas.width = certImage.naturalWidth;
  canvas.height = certImage.naturalHeight;
  ctx.drawImage(certImage, 0, 0);
};

certImage.onerror = () => {
  alert("ERROR: certificate.png failed to load. Check filename and refresh cache.");
};

function generateCert() {
  if (!imageLoaded) {
    alert("Certificate image still loading. Try again in a second.");
    return;
  }

  const name = document.getElementById("nameInput").value.trim();
  if (!name) {
    alert("Enter your name first!");
    return;
  }

  // Redraw base certificate
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.drawImage(certImage, 0, 0);

  // Name styling
  ctx.font = "120px Impact";
  ctx.fillStyle = "#000000";
  ctx.textAlign = "center";

  // Drop shadow
  ctx.shadowColor = "rgba(0,0,0,0.45)";
  ctx.shadowBlur = 6;
  ctx.shadowOffsetX = 3;
  ctx.shadowOffsetY = 3;

  // Position (perfect under AWARDED TO)
  const x = canvas.width / 2;
  const y = canvas.height * 0.67;

  ctx.fillText(name, x, y);

  // Reset shadow so it doesn't affect anything else
  ctx.shadowColor = "transparent";
}

function downloadCert() {
  const link = document.createElement("a");
  link.download = "WRW_Rattler_Certificate.png";
  link.href = canvas.toDataURL("image/png");
  link.click();
}
</script>